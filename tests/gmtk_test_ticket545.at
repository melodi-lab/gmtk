# Verify that https://j.ee.washington.edu/trac/gmtk/ticket/545 is implemented

# If it's working, the inference results with -linearSpace T should match
# those with -linearSpace F

AT_SETUP([O(Tn) space inference (ticket 545)])
AT_SKIP_IF([test ! -d $TEST_AND_DEV/auroraTutorial])
AT_CHECK([(export GMTK_TEST_DIR=`pwd` && 
  cd $TEST_AND_DEV/auroraTutorial &&
  gmtkViterbi -of1 DATA/small.pfile -iswp1 T         \
    -inputMasterFile PARAMS/nonTrainable.master      \
    -inputTrainable PARAMS/highly_trained.gmp        \
    -str PARAMS/aurora_decode.str                    \
    -mVitVals $GMTK_TEST_DIR/vit.norm                \
    -keepOnlyInterfaceSeparatorMemory F)
 (export GMTK_TEST_DIR=`pwd` && 
  cd $TEST_AND_DEV/auroraTutorial &&
  gmtkViterbi -of1 DATA/small.pfile -iswp1 T         \
    -inputMasterFile PARAMS/nonTrainable.master      \
    -inputTrainable PARAMS/highly_trained.gmp        \
    -str PARAMS/aurora_decode.str                    \
    -mVitVals $GMTK_TEST_DIR/vit.OTn                 \
    -keepOnlyInterfaceSeparatorMemory T)
  cmp vit.norm vit.OTn],[0],[ignore],[ignore])
AT_CLEANUP

